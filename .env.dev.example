# API runtime environment (FastAPI/Celery). Copy to .env.dev.
# Docker Compose uses the repo-root .env instead.

# Storage provider (s3 | supabase | memory)
STORAGE_PROVIDER=s3
BUCKET_ORIGINALS=originals

# S3-compatible storage (RustFS/MinIO/AWS)
S3_ENDPOINT_URL=http://localhost:9000
S3_REGION=us-east-1
S3_ACCESS_KEY_ID=rustfs
S3_SECRET_ACCESS_KEY=rustfs123
S3_FORCE_PATH_STYLE=true

# Supabase (optional)
# SUPABASE_ANON_KEY=
SUPABASE_URL=
SUPABASE_SERVICE_ROLE_KEY=

# Local services
REDIS_URL=redis://localhost:6379/0
QDRANT_URL=http://localhost:6333
POSTGRES_HOST=localhost
POSTGRES_PORT=5432
POSTGRES_DB=lifelog
POSTGRES_USER=lifelog
POSTGRES_PASSWORD=lifelog

# Example for managed Postgres (Supabase) - do not use in local dev
# POSTGRES_HOST=db.xxxx.supabase.co  # pooler host or direct host
# POSTGRES_PORT=6543
# POSTGRES_PASSWORD=


# OAuth credentials for local dev
GOOGLE_PHOTOS_CLIENT_ID=your_client_id_here
GOOGLE_PHOTOS_CLIENT_SECRET=your_client_secret_here
GOOGLE_PHOTOS_REDIRECT_URI=http://localhost:8000/integrations/google/photos/callback
# Optional, only if your web app runs elsewhere:
# WEB_APP_URL=http://localhost:3000

# Authentik OIDC (optional)
AUTH_ENABLED=false
OIDC_ISSUER_URL=http://localhost:9002/application/o/omnimemory/
OIDC_JWKS_URL=http://localhost:9002/application/o/omnimemory/jwks/
OIDC_AUDIENCE=omnimemory
OIDC_USER_ID_CLAIM=sub
OIDC_EMAIL_CLAIM=email
OIDC_NAME_CLAIM=name

# OCR and VLM settings
OCR_PROVIDER=google_cloud_vision
OCR_GOOGLE_API_KEY=your-vision-key
OCR_LANGUAGE_HINTS=en

VLM_PROVIDER=gemini
GEMINI_API_KEY=your-gemini-key
GEMINI_MODEL=gemini-2.5-flash-lite   # or gemini-1.5-pro-latest if thatâ€™s what you have access to

VLM_TEMPERATURE=0.2
VLM_MAX_OUTPUT_TOKENS=2048
OCR_TIMEOUT_SECONDS=15
VLM_TIMEOUT_SECONDS=30

# Video/audio understanding settings
VIDEO_UNDERSTANDING_PROVIDER=gemini            # Gemini provider for chunk analysis (video)
VIDEO_UNDERSTANDING_MODEL=gemini-2.5-flash-lite
VIDEO_UNDERSTANDING_TEMPERATURE=0.2
VIDEO_UNDERSTANDING_TIMEOUT_SECONDS=60
VIDEO_UNDERSTANDING_MAX_BYTES=19000000         # Per-chunk inline payload cap
VIDEO_UNDERSTANDING_MAX_DURATION_SEC=300       # Reject videos longer than this (seconds)

AUDIO_UNDERSTANDING_PROVIDER=gemini            # Gemini provider for chunk analysis (audio)
AUDIO_UNDERSTANDING_MODEL=gemini-2.5-flash-lite
AUDIO_UNDERSTANDING_TEMPERATURE=0.2
AUDIO_UNDERSTANDING_TIMEOUT_SECONDS=60
AUDIO_UNDERSTANDING_MAX_BYTES=19000000         # Per-chunk inline payload cap

# Output sizing for chunked transcript + context responses
TRANSCRIPTION_MAX_OUTPUT_TOKENS=4096           # Allow enough room for transcript + contexts
TRANSCRIPTION_STORAGE_MAX_BYTES=500000         # Store transcript JSON in storage if larger

# Media extraction settings
MEDIA_MAX_BYTES=1000000000                     # Reject ingest if file exceeds this size
MEDIA_CHUNK_TARGET_BYTES=10000000              # Target chunk size (bytes) for Gemini calls
MEDIA_CHUNK_MAX_CHUNKS=240                      # Safety cap on number of chunks processed
INGEST_BATCH_LIMIT=200                          # Max items per batch ingest request
VIDEO_MAX_DURATION_SEC=300                      # Reject ingest if video exceeds this duration
AUDIO_MAX_DURATION_SEC=3600                     # Reject ingest if audio exceeds this duration
VIDEO_CHUNK_DURATION_SEC=60                     # Default chunk duration for videos (seconds)
AUDIO_CHUNK_DURATION_SEC=300                    # Default chunk duration for audios (seconds)
AUDIO_SAMPLE_RATE_HZ=16000                      # Audio extraction sample rate for chunking
AUDIO_CHANNELS=1                                # Mono audio extraction for chunking
VIDEO_KEYFRAME_MODE=interval                       # scene|interval for keyframe extraction
VIDEO_SCENE_THRESHOLD=0.3                       # Threshold for scene detection
VIDEO_KEYFRAME_INTERVAL_SEC=5                   # Used when VIDEO_KEYFRAME_MODE=interval
VIDEO_MAX_KEYFRAMES=60                          # Cap on keyframes stored per video
VIDEO_VLM_MAX_FRAMES=24                         # Reserved for future keyframe VLM
VIDEO_KEYFRAMES_ALWAYS=true                     # Always extract keyframes (even if analysis succeeds)
VIDEO_VLM_CONCURRENCY=2                         # Reserved for future keyframe VLM
VIDEO_PREVIEW_ENABLED=true                     # Generate low-res preview MP4s for faster UI playback
VIDEO_PREVIEW_DURATION_SEC=8                    # Max duration of preview clip
VIDEO_PREVIEW_MAX_WIDTH=640                     # Max width (height auto-scaled)
VIDEO_PREVIEW_FPS=12                            # Target preview frame rate
VIDEO_PREVIEW_BITRATE_KBPS=600                  # Target preview bitrate

# Episode + semantic merge settings
SEMANTIC_MERGE_ENABLED=true                     # Merge similar per-item contexts
SEMANTIC_MERGE_MIN_JACCARD=0.6                  # Similarity threshold for per-item merge
EPISODE_MERGE_ENABLED=true                      # Build/extend episodes as items ingest
EPISODE_MERGE_MAX_GAP_MINUTES=90                # Max gap between items to extend an episode
EPISODE_MERGE_SIMILARITY_THRESHOLD=0.78         # Similarity needed to attach item to episode

# Chat settings
CHAT_MAX_OUTPUT_TOKENS=2048

# Agent settings
AGENT_ENABLED=true
AGENT_PROMPT_MODEL=gemini-2.5-flash-lite
AGENT_PROMPT_TEMPERATURE=0.4
AGENT_IMAGE_PROVIDER=gemini
AGENT_IMAGE_MODEL=gemini-2.5-flash-image
AGENT_IMAGE_TIMEOUT_SECONDS=60

# Maps settings
MAPS_GEOCODING_PROVIDER=google_maps
MAPS_GOOGLE_API_KEY=your-maps-key

# Enable detailed pipeline logging for local dev
PIPELINE_LOG_DETAILS=true
PIPELINE_REPROCESS_DUPLICATES=true

# Embedding settings
EMBEDDING_PROVIDER=gemini
EMBEDDING_MODEL=gemini-embedding-001
EMBEDDING_DIMENSION=3072

# Qdrant settings
QDRANT_COLLECTION=lifelog-items

# Deduplication settings
DEDUPE_NEAR_WINDOW_MINUTES=1
DEDUPE_NEAR_HAMMING_THRESHOLD=6


# Optional: OpenAI / Anthropic keys for local testing
OPENAI_API_KEY=
ANTHROPIC_API_KEY=
