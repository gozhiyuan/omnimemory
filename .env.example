# OmniMemory Environment Configuration
# Copy to .env and fill in values. Used by both Docker Compose and local API/Celery.
#
# Frontend uses apps/web/.env.local (separate file due to Vite VITE_ prefix requirement)

# =============================================================================
# DATABASE (Postgres)
# =============================================================================
POSTGRES_HOST=localhost
POSTGRES_PORT=5432
POSTGRES_DB=lifelog
POSTGRES_USER=lifelog
POSTGRES_PASSWORD=lifelog

# Example for managed Postgres (Supabase) - uncomment for production
# POSTGRES_HOST=db.xxxx.supabase.co
# POSTGRES_PORT=6543

# =============================================================================
# REDIS / CELERY
# =============================================================================
REDIS_URL=redis://localhost:6379/0

# =============================================================================
# VECTOR DATABASE (Qdrant)
# =============================================================================
QDRANT_URL=http://localhost:6333
QDRANT_COLLECTION=lifelog-items

# =============================================================================
# OBJECT STORAGE (S3-compatible)
# =============================================================================
# Storage provider: s3 | supabase | memory
STORAGE_PROVIDER=s3
BUCKET_ORIGINALS=originals

# RustFS / MinIO / AWS S3
RUSTFS_IMAGE=rustfs/rustfs:latest
S3_ENDPOINT_URL=http://localhost:9000
S3_REGION=us-east-1
S3_ACCESS_KEY_ID=rustfs
S3_SECRET_ACCESS_KEY=rustfs123
S3_FORCE_PATH_STYLE=true

# Supabase Storage (optional, for production)
# SUPABASE_URL=
# SUPABASE_ANON_KEY=
# SUPABASE_SERVICE_ROLE_KEY=

# =============================================================================
# AUTHENTICATION (Authentik OIDC)
# =============================================================================
AUTH_ENABLED=false
OIDC_ISSUER_URL=http://localhost:9002/application/o/omnimemory/
OIDC_JWKS_URL=http://localhost:9002/application/o/omnimemory/jwks/
OIDC_AUDIENCE=omnimemory
OIDC_USER_ID_CLAIM=sub
OIDC_EMAIL_CLAIM=email
OIDC_NAME_CLAIM=name

# Authentik container config
AUTHENTIK_SECRET_KEY=replace-with-32+char-random-string
AUTHENTIK_IMAGE_TAG=2024.12.3
AUTHENTIK_POSTGRES_DB=authentik
AUTHENTIK_POSTGRES_USER=authentik
AUTHENTIK_POSTGRES_PASSWORD=authentik
# Optional: auto-create admin user on first boot
# AUTHENTIK_BOOTSTRAP_EMAIL=admin@example.com
# AUTHENTIK_BOOTSTRAP_PASSWORD=change-me

# =============================================================================
# DEVICE AUTH (ESP32)
# =============================================================================
DEVICE_TOKEN_SECRET=dev-device-token-secret
DEVICE_PAIRING_CODE_TTL_MINUTES=10

# =============================================================================
# GOOGLE INTEGRATIONS
# =============================================================================
# Google Photos OAuth
GOOGLE_PHOTOS_CLIENT_ID=your_client_id_here
GOOGLE_PHOTOS_CLIENT_SECRET=your_client_secret_here
GOOGLE_PHOTOS_REDIRECT_URI=http://localhost:8000/integrations/google/photos/callback
# WEB_APP_URL=http://localhost:3000  # Optional, if web app runs elsewhere

# Google Cloud Vision (OCR)
OCR_PROVIDER=google_cloud_vision
OCR_GOOGLE_API_KEY=your-vision-key
OCR_LANGUAGE_HINTS=en
OCR_TIMEOUT_SECONDS=15

# Google Maps (Geocoding)
MAPS_GEOCODING_PROVIDER=google_maps
MAPS_GOOGLE_API_KEY=your-maps-key

# =============================================================================
# AI PROVIDERS
# =============================================================================
# Gemini (primary)
GEMINI_API_KEY=your-gemini-key
GEMINI_MODEL=gemini-2.5-flash-lite

# VLM (Vision Language Model)
VLM_PROVIDER=gemini
VLM_TEMPERATURE=0.2
VLM_MAX_OUTPUT_TOKENS=2048
VLM_TIMEOUT_SECONDS=30

# Embeddings
EMBEDDING_PROVIDER=gemini
EMBEDDING_MODEL=gemini-embedding-001
EMBEDDING_DIMENSION=3072

# Chat
CHAT_MAX_OUTPUT_TOKENS=2048

# Agent
AGENT_ENABLED=true
AGENT_PROMPT_MODEL=gemini-2.5-flash-lite
AGENT_PROMPT_TEMPERATURE=0.4
AGENT_IMAGE_PROVIDER=gemini
AGENT_IMAGE_MODEL=gemini-2.5-flash-image
AGENT_IMAGE_TIMEOUT_SECONDS=60

# Optional: OpenAI / Anthropic
# OPENAI_API_KEY=
# ANTHROPIC_API_KEY=

# =============================================================================
# VIDEO PROCESSING
# =============================================================================
VIDEO_UNDERSTANDING_PROVIDER=gemini
VIDEO_UNDERSTANDING_MODEL=gemini-2.5-flash-lite
VIDEO_UNDERSTANDING_TEMPERATURE=0.2
VIDEO_UNDERSTANDING_TIMEOUT_SECONDS=60
VIDEO_UNDERSTANDING_MAX_BYTES=19000000
VIDEO_UNDERSTANDING_MAX_DURATION_SEC=300

VIDEO_MAX_DURATION_SEC=300
VIDEO_CHUNK_DURATION_SEC=60
VIDEO_KEYFRAME_MODE=interval
VIDEO_SCENE_THRESHOLD=0.3
VIDEO_KEYFRAME_INTERVAL_SEC=5
VIDEO_MAX_KEYFRAMES=60
VIDEO_VLM_MAX_FRAMES=24
VIDEO_KEYFRAMES_ALWAYS=true
VIDEO_VLM_CONCURRENCY=2
VIDEO_PREVIEW_ENABLED=true
VIDEO_PREVIEW_DURATION_SEC=8
VIDEO_PREVIEW_MAX_WIDTH=640
VIDEO_PREVIEW_FPS=12
VIDEO_PREVIEW_BITRATE_KBPS=600

# =============================================================================
# AUDIO PROCESSING
# =============================================================================
AUDIO_UNDERSTANDING_PROVIDER=gemini
AUDIO_UNDERSTANDING_MODEL=gemini-2.5-flash-lite
AUDIO_UNDERSTANDING_TEMPERATURE=0.2
AUDIO_UNDERSTANDING_TIMEOUT_SECONDS=60
AUDIO_UNDERSTANDING_MAX_BYTES=19000000

AUDIO_MAX_DURATION_SEC=3600
AUDIO_CHUNK_DURATION_SEC=300
AUDIO_SAMPLE_RATE_HZ=16000
AUDIO_CHANNELS=1

# Voice Activity Detection
AUDIO_VAD_ENABLED=true
AUDIO_VAD_SILENCE_DB=-35
AUDIO_VAD_MIN_SILENCE_SEC=0.4
AUDIO_VAD_PADDING_SEC=0.15
AUDIO_VAD_MIN_SEGMENT_SEC=0.8

# Transcription output
TRANSCRIPTION_MAX_OUTPUT_TOKENS=4096
TRANSCRIPTION_STORAGE_MAX_BYTES=500000

# =============================================================================
# MEDIA EXTRACTION
# =============================================================================
MEDIA_MAX_BYTES=1000000000
MEDIA_CHUNK_TARGET_BYTES=10000000
MEDIA_CHUNK_MAX_CHUNKS=240
INGEST_BATCH_LIMIT=200

# =============================================================================
# EPISODE / SEMANTIC MERGE
# =============================================================================
SEMANTIC_MERGE_ENABLED=true
SEMANTIC_MERGE_MIN_JACCARD=0.6
EPISODE_MERGE_ENABLED=true
EPISODE_MERGE_MAX_GAP_MINUTES=90
EPISODE_MERGE_SIMILARITY_THRESHOLD=0.78
DEVICE_EPISODE_MERGE_WINDOW_MINUTES=5

# =============================================================================
# DEDUPLICATION
# =============================================================================
DEDUPE_NEAR_WINDOW_MINUTES=1
DEDUPE_NEAR_HAMMING_THRESHOLD=6

# =============================================================================
# OBSERVABILITY
# =============================================================================
GRAFANA_ADMIN_USER=admin
GRAFANA_ADMIN_PASSWORD=admin

# Pipeline debugging
PIPELINE_LOG_DETAILS=true
PIPELINE_REPROCESS_DUPLICATES=true
